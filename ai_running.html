<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI QA Platform â€“ AI QA ì‹¤í–‰ ì¤‘</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f4f6f9;
      color: #222;
    }

    header {
      background: #ffffff;
      padding: 16px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 18px;
      margin: 0;
    }

    header span {
      font-size: 13px;
      color: #6b7280;
    }

    main {
      max-width: 960px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .page-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .page-desc {
      color: #6b7280;
      margin-bottom: 28px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    }

    /* ì§„í–‰ ìƒíƒœ */
    .steps {
      display: flex;
      gap: 16px;
      font-size: 14px;
    }

    .step {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      background: #f3f4f6;
      color: #6b7280;
      text-align: center;
    }

    .step.active {
      background: #2563eb;
      color: #ffffff;
      font-weight: 600;
    }

    .step.done {
      background: #ecfdf5;
      color: #047857;
    }

    /* ë¡œê·¸ */
    .log {
      font-size: 14px;
      line-height: 1.6;
      color: #374151;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .log p {
      margin: 0 0 8px 0;
    }

    .log span {
      color: #6b7280;
      font-size: 12px;
      margin-right: 6px;
    }

    /* í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ */
    .scenario {
      font-size: 14px;
      color: #374151;
    }

    .scenario strong {
      display: block;
      font-size: 15px;
      margin-top: 6px;
    }

    /* í•˜ë‹¨ */
    .footer-msg {
      margin-top: 28px;
      text-align: center;
      font-size: 13px;
      color: #6b7280;
    }

    /* ì‹¤í–‰ ì¤‘ë‹¨ ë²„íŠ¼ */
    .back-btn {
      font-size: 14px;
      text-decoration: none;
      margin-right: 16px;
    }

    .back-btn.warning {
      color: #c2410c;
    }

    .back-btn.warning:hover {
      text-decoration: underline;
    }

        /* STEP ì§„í–‰ ë°” */
    .step-bar {
      max-width: 960px;
      margin: 24px auto 0;
      padding: 0 20px;
      display: flex;
      gap: 12px;
    }

    .step-item {
      flex: 1;
      padding: 10px 12px;
      border-radius: 999px;
      text-align: center;
      font-size: 13px;
      background: #f3f4f6;
      color: #6b7280;
    }

    .step-item a {
      color: inherit;
      text-decoration: none;
    }

    .step-item.done {
      background: #ecfdf5;
      color: #047857;
    }

    .step-item.active {
      background: #2563eb;
      color: #ffffff;
      font-weight: 600;
    }
  </style>
</head>

<body>

  <header>
    <h1>AI QA Platform</h1>
    <span>STEP 3 Â· AI QA ì‹¤í–‰ ì¤‘</span>
  </header>

  <div class="step-bar">
  <div class="step-item done">
    <a href="index.html">â‘  ì‹œë‚˜ë¦¬ì˜¤ ì—…ë¡œë“œ</a>
  </div>
  <div class="step-item done">
    <a href="ai_run.html">â‘¡ AI QA ì‹¤í–‰</a>
  </div>
  <div class="step-item active">
    â‘¢ ì‹¤í–‰ ì¤‘
  </div>
  </div>

  <main>
    <div class="page-title" id="pageTitle">AI QA ì‹¤í–‰ ì¤‘</div>

<div class="page-desc" id="pageDesc">
  AIê°€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í•´ì„í•˜ê³  ì‹¤ì œ QAë¥¼ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br />
  ì´ ì‘ì—…ì€ ëª‡ ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</div>

    <!-- ì „ì²´ ì§„í–‰ ìƒíƒœ -->
    <div class="card">
      <div class="steps">
      <div class="step done" id="step-parse">â‘  ì‹œë‚˜ë¦¬ì˜¤ í•´ì„</div>
      <div class="step active" id="step-run">â‘¡ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</div>
      <div class="step" id="step-result">â‘¢ ê²°ê³¼ íŒë‹¨</div>
      </div>
    </div>

    <!-- í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ -->
    <div class="card">
      <div class="scenario">
        í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‹œë‚˜ë¦¬ì˜¤
        <strong id="scenarioTitle"></strong>
      </div>
    </div>

    <!-- ì‹¤í–‰ ë¡œê·¸ -->
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:12px;">AI ì‹¤í–‰ ë¡œê·¸</h2>
      <div class="log" id="logArea">
      </div>
    </div>

    <div class="card" id="resultSummary" style="display:none;">
  <h2 style="font-size:16px; margin-bottom:12px;">
    ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
  </h2>
  <ul style="font-size:14px; line-height:1.6;">
    <li>ì´ Step ìˆ˜: <span id="resultTotalSteps"></span></li>
    <li>ì„±ê³µ: 35</li>
    <li>ì˜¤ë¥˜(ì§„í–‰ ê°€ëŠ¥): 5</li>
    <li style="color:#b91c1c; font-weight:600;">
      ì‹¤íŒ¨(ì¤‘ë‹¨): 1
    </li>
  </ul>
</div>

    <div class="footer-msg">
      ì‹¤í–‰ ì¤‘ì—ëŠ” ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    </div>

    <div
  id="failCountdown"
  style="
    display:none;
    margin-top:16px;
    text-align:center;
    font-size:14px;
    color:#b91c1c;
    font-weight:600;
  "
></div>

  <div id="resultActions"
     style="display:none; margin-top:24px; text-align:right;">

  <button
    style="
      padding:10px 16px;
      border-radius:8px;
      border:none;
      background:#dc2626;
      color:#ffffff;
      font-size:14px;
      cursor:pointer;
    "
    onclick="location.href='ai-fail-result.html'">
    QA ì‹¤íŒ¨ ê²°ê³¼ ë³´ê¸°
  </button>

</div>
  </main>

<script>
const params = new URLSearchParams(window.location.search);
const mode = params.get("mode"); // null | "result"

const logArea = document.getElementById("logArea");

/* âœ… STEP + ë¡œê·¸ êµ¬ì¡° */
const steps = [
  {
    name: "ì œëª© ì…ë ¥ ê²€ì¦",
    logs: [
      { text: "ì‹œë‚˜ë¦¬ì˜¤ í•´ì„ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.", type: "normal" },
      { text: "í…ŒìŠ¤íŠ¸ ë‹¨ê³„ 3ê°œë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.", type: "normal" },
      { text: "ë¸Œë¼ìš°ì € í™˜ê²½ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.", type: "normal" },
      { text: "ê³¼ì œ ìƒì„± ë²„íŠ¼ í´ë¦­", type: "normal" },
      { text: "ì œëª© ì…ë ¥ í•„ë“œ ì ‘ê·¼", type: "normal" },
      { text: "ë¹ˆ ê°’ ì…ë ¥ ì‹œë„", type: "normal" },
      {
        text: "ì—ëŸ¬ ë©”ì‹œì§€ ë¯¸ë…¸ì¶œ",
        type: "warning",
        detail: "ë¹ˆ ê°’ ì…ë ¥ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë…¸ì¶œë˜ì–´ì•¼ í•˜ë‚˜ í™•ì¸ë˜ì§€ ì•ŠìŒ",
        canContinue: true
      }
    ]
  },
  {
    name: "ì €ì¥ ë²„íŠ¼ ê²€ì¦",
    logs: [
      {
        text: "ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹¤íŒ¨",
        type: "fail",
        detail: "í•„ìˆ˜ ê°’ ëˆ„ë½ìœ¼ë¡œ ì €ì¥ API í˜¸ì¶œ ë¶ˆê°€",
        canContinue: false
      }
    ]
  }
];

function appendLog(text, type, detail) {
  const time = new Date().toLocaleTimeString("ko-KR", { hour12: false });

  // ğŸ”¹ 1. ì‹¤í–‰ ë¡œê·¸ ê°ì²´
  const logItem = {
    time,
    text,
    type,
    detail
  };

  // ğŸ”¹ 2. ê¸°ì¡´ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°
  const logs = JSON.parse(sessionStorage.getItem("aiRunLogs") || "[]");

  // ğŸ”¹ 3. ë¡œê·¸ ì €ì¥
  logs.push(logItem);
  sessionStorage.setItem("aiRunLogs", JSON.stringify(logs));

  // ğŸ”¹ 4. í™”ë©´ ì¶œë ¥ (ê¸°ì¡´ ë¡œì§)
  const p = document.createElement("p");
  p.innerHTML = `<span>${time}</span>${text}`;

  if (type === "warning" || type === "fail") {
    p.style.fontWeight = "600";
    p.style.color = type === "fail" ? "#dc2626" : "#d97706";

    if (detail) {
      const btn = document.createElement("button");
      btn.textContent = "ìƒì„¸ë³´ê¸°";
      btn.style.marginLeft = "8px";
      btn.style.fontSize = "12px";
      btn.onclick = () => alert(detail);
      p.appendChild(btn);
    }
  }

  logArea.appendChild(p);
  logArea.scrollTop = logArea.scrollHeight;
}


let stepIndex = 0;
let logIndex = 0;

if (mode === "result") {
  // STEP UI
  document.getElementById("step-parse").className = "step done";
  document.getElementById("step-run").className = "step done";
  document.getElementById("step-result").className = "step active";

  // ì œëª© / ì„¤ëª…
  document.getElementById("pageTitle").textContent = "AI QA ì‹¤í–‰ ê²°ê³¼";
  document.getElementById("pageDesc").style.display = "none";

  // ê²°ê³¼ ìš”ì•½ ë…¸ì¶œ
  document.getElementById("resultSummary").style.display = "block";

  // ğŸ”¥ í•µì‹¬: ì‹¤í–‰ ì¤‘ ë¡œê·¸ ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
  renderResultLogs();
}

let interval = null;

if (mode !== "result") {
  interval = setInterval(() => {
  if (stepIndex >= steps.length) {
  clearInterval(interval);

  // ğŸ”¹ STEP UI ì „í™˜
  document.querySelectorAll(".step").forEach(el =>
    el.classList.remove("active")
  );
  document.querySelectorAll(".step")[2].classList.add("active"); // â‘¢ ê²°ê³¼ íŒë‹¨

  // ğŸ”¹ ë¡œê·¸ ì¬ì‚¬ìš©
  renderResultLogs();

  return;
}

  const step = steps[stepIndex];
  const log = step.logs[logIndex];

  appendLog(log.text, log.type, log.detail);

  // âŒ ì¹˜ëª…ì  ì˜¤ë¥˜ â†’ ì¢…ë£Œ
  if (log.type === "fail" && log.canContinue === false) {
  clearInterval(interval);

  const countdownEl = document.getElementById("failCountdown");
  let seconds = 3;

  countdownEl.style.display = "block";
  countdownEl.textContent =
    `âš  QA ì‹¤í–‰ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ${seconds}ì´ˆ í›„ ì‹¤í–‰ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`;

  const countdownTimer = setInterval(() => {
    seconds--;

    if (seconds <= 0) {
      clearInterval(countdownTimer);
      window.location.href = "ai-fail-result.html";
    } else {
      countdownEl.textContent =
        `âš  QA ì‹¤í–‰ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ${seconds}ì´ˆ í›„ ì‹¤í–‰ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`;
    }
  }, 1000);

  return;
}

  logIndex++;

  // í˜„ì¬ step ë â†’ ë‹¤ìŒ step
  if (logIndex >= step.logs.length) {
    stepIndex++;
    logIndex = 0;
  }
}, 1500);
}

if (mode === "result") {
  document.getElementById("pageTitle").textContent = "AI QA ì‹¤í–‰ ê²°ê³¼";
  document.getElementById("pageDesc").style.display = "none";
  document.querySelector(".footer-msg").style.display = "none";

    // âœ… ê²°ê³¼ í˜ì´ì§€ ì´ë™ ë²„íŠ¼ ë…¸ì¶œ
  document.getElementById("resultActions").style.display = "block";

    // âœ… ì¶”ê°€í•´ì•¼ í•˜ëŠ” í•µì‹¬ ì½”ë“œ
  renderResultLogs();
}

if (mode === "result") {
  document.getElementById("resultSummary").style.display = "block";
}

function renderResultLogs() {
  const logs = JSON.parse(sessionStorage.getItem("aiRunLogs") || "[]");
  logArea.innerHTML = ""; // ê¸°ì¡´ ë¡œê·¸ ì´ˆê¸°í™”

  logs.forEach(log => {
    const p = document.createElement("p");
    p.innerHTML = `<span>${log.time}</span>${log.text}`;

    if (log.type === "warning" || log.type === "fail") {
      p.style.fontWeight = "600";
      p.style.color = log.type === "fail" ? "#dc2626" : "#d97706";

      if (log.detail) {
        const btn = document.createElement("button");
        btn.textContent = "ìƒì„¸ë³´ê¸°";
        btn.style.marginLeft = "8px";
        btn.style.fontSize = "12px";
        btn.onclick = () => alert(log.detail);
        p.appendChild(btn);
      }
    }

    logArea.appendChild(p);
  });
}

const scenarioTitleEl = document.getElementById("scenarioTitle");

const scenarioName = localStorage.getItem("scenarioFileName");
const totalStepCount = localStorage.getItem("totalStepCount");

scenarioTitleEl.textContent =
  scenarioName
    ? `${scenarioName} (${totalStepCount} Steps)`
    : "ì‹œë‚˜ë¦¬ì˜¤ ì •ë³´ ì—†ìŒ";

const resultTotalStepsEl = document.getElementById("resultTotalSteps");
if (resultTotalStepsEl) {
  resultTotalStepsEl.textContent =
    localStorage.getItem("totalStepCount");
}
</script>

</body>
</html>
